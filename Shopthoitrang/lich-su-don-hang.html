<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lịch sử đơn hàng</title>
  <link rel="stylesheet" href="/Shopthoitrang/css/gio-hang.css">
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background-color: #333; color: white; padding: 10px 20px; text-align: center; }
    header h1 { margin: 0; }
    nav a { color: white; margin: 0 15px; text-decoration: none; }
    nav a:hover { text-decoration: underline; }
    section { max-width: 900px; margin: 20px auto; padding: 20px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background-color: #f2f2f2; }
    #message { color: green; margin-bottom: 10px; text-align: center; font-weight: bold; }
  </style>
</head>
<body>
  <header>
    <h1>DTN Shop</h1>
    <nav>
      <a href="/Shopthoitrang/trang-chu.html">Trang chủ</a>
      <a href="/Shopthoitrang/dat-hang.html">Sản phẩm</a>
      <a href="/Shopthoitrang/gio-hang.html">Giỏ hàng</a>
    </nav>
  </header>

  <section>
    <h2>Lịch sử đơn hàng</h2>
    <div id="message"></div>
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Ngày đặt</th>
          <th>Tổng tiền</th>
          <th>Trạng thái</th>
        </tr>
      </thead>
      <tbody id="orderList">
        <tr><td colspan="4">Đang tải...</td></tr>
      </tbody>
    </table>
  </section>

  <script>
    window.onload = async () => {
      const idKhachHang = localStorage.getItem('id_khach_hang');
      if (!idKhachHang) {
        document.getElementById('message').textContent = 'Vui lòng đăng nhập để xem lịch sử đơn hàng';
        document.getElementById('orderList').innerHTML = '<tr><td colspan="4">Không có dữ liệu</td></tr>';
        return;
      }

      try {
        const res = await fetch(`http://127.0.0.1:5000/donhang?id_khach_hang=${idKhachHang}`);
        const orders = await res.json();

        const tbody = document.getElementById('orderList');
        tbody.innerHTML = '';

        if (orders.length === 0) {
          tbody.innerHTML = '<tr><td colspan="4">Chưa có đơn hàng nào</td></tr>';
          return;
        }

        orders.forEach(order => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${order.id_don_hang}</td>
            <td>${new Date(order.ngay_dat).toLocaleString('vi-VN')}</td>
            <td>${parseFloat(order.tong_tien).toLocaleString('vi-VN')} VNĐ</td>
            <td>${order.trang_thai}</td>
          `;
          tbody.appendChild(row);
        });

        document.getElementById('message').textContent = 'Đơn hàng gần đây của bạn';
      } catch (err) {
        console.error('Lỗi tải đơn hàng:', err);
        document.getElementById('orderList').innerHTML = '<tr><td colspan="4">Lỗi khi tải dữ liệu</td></tr>';
      }
    }
  </script>
</body>
</html>
