<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Trị Danh Mục - DTN Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .table-container { margin: 20px; }
        .form-container { margin: 20px; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">DTN Shop Admin</a>
            <div class="navbar-nav">
                <a class="nav-link" href="/Shopthoitrang/admin-products.html">Sản Phẩm</a>
                <a class="nav-link active" href="/Shopthoitrang/admin.html">Quay lại</a>
            </div>
        </div>
    </nav>

    <div class="form-container">
        <h2>Thêm Danh Mục</h2>
        <form id="addCategoryForm">
            <div class="mb-3">
                <label class="form-label">Tên Danh Mục</label>
                <input type="text" class="form-control" id="ten_danh_muc" required>
            </div>
            <button type="submit" class="btn btn-primary">Thêm Danh Mục</button>
        </form>
    </div>

    <div class="table-container">
        <h2>Danh Sách Danh Mục</h2>
        <table class="table table-striped" id="categoryTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Tên Danh Mục</th>
                    <th>Hành Động</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        async function loadCategories() {
            try {
                const response = await fetch('http://127.0.0.1:5000/danhmuc');
                if (!response.ok) throw new Error('Không thể lấy danh sách danh mục');
                const categories = await response.json();
                const tbody = document.getElementById('categoryTable').getElementsByTagName('tbody')[0];
                tbody.innerHTML = '';
                categories.forEach(category => {
                    const row = `
                        <tr>
                            <td>${category.id_danh_muc}</td>
                            <td>${category.ten_danh_muc}</td>
                            <td>
                                <button class="btn btn-warning btn-sm" onclick="editCategory(${category.id_danh_muc})">Sửa</button>
                                <button class="btn btn-danger btn-sm" onclick="deleteCategory(${category.id_danh_muc})">Xóa</button>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } catch (error) {
                console.error('Lỗi:', error);
                alert('Lỗi khi tải danh sách danh mục');
            }
        }

        async function addCategory() {
            const category = { ten_danh_muc: document.getElementById('ten_danh_muc').value };
            try {
                const response = await fetch('http://127.0.0.1:5000/danhmuc', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(category)
                });
                if (response.ok) {
                    alert('Thêm danh mục thành công');
                    document.getElementById('addCategoryForm').reset();
                    loadCategories();
                } else {
                    throw new Error('Thêm danh mục thất bại');
                }
            } catch (error) {
                console.error('Lỗi:', error);
                alert('Lỗi khi thêm danh mục');
            }
        }

        async function editCategory(id) {
            const newName = prompt('Nhập tên danh mục mới:', '');
            if (newName) {
                try {
                    const response = await fetch(`http://127.0.0.1:5000/danhmuc/${id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ ten_danh_muc: newName })
                    });
                    if (response.ok) {
                        alert('Cập nhật danh mục thành công');
                        loadCategories();
                    } else {
                        throw new Error('Cập nhật danh mục thất bại');
                    }
                } catch (error) {
                    console.error('Lỗi:', error);
                    alert('Lỗi khi cập nhật danh mục');
                }
            }
        }

        async function deleteCategory(id) {
            if (confirm('Bạn có chắc muốn xóa danh mục này?')) {
                try {
                    const response = await fetch(`http://127.0.0.1:5000/danhmuc/${id}`, {
                        method: 'DELETE'
                    });
                    const result = await response.json();
                    alert(result.message);
                    loadCategories();
                } catch (error) {
                    console.error('Lỗi:', error);
                    alert('Lỗi khi xóa danh mục');
                }
            }
        }

        document.getElementById('addCategoryForm').addEventListener('submit', function(e) {
            e.preventDefault();
            addCategory();
        });

        window.onload = loadCategories;
    </script>
</body>
</html>